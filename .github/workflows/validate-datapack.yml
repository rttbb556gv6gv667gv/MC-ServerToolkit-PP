# Loot table'lar iÃ§in Ã¶zel kontrol
echo "  ðŸŽ Checking loot tables for book menus..."
loot_book_count=0

while IFS= read -r -d $'\0' file; do
  relative_path=$(echo "$file" | sed "s|^$(pwd)/||")
  
  if jq -e '.. | select(.function? == "minecraft:set_written_book_pages")' "$file" >/dev/null 2>&1; then
    echo "  ðŸ“– $relative_path - Contains written book in loot"
    loot_book_count=$((loot_book_count + 1))
    
    # clickEvent kontrolÃ¼
    if jq -e '.. | select(.clickEvent?.action? == "run_command")' "$file" >/dev/null 2>&1; then
      cmd=$(jq -r '.. | select(.clickEvent?.action? == "run_command") | .clickEvent.value' "$file" 2>/dev/null)
      
      if [[ "$cmd" =~ op|execute|function|gamemode|give.*command_block ]]; then
        echo "     ðŸš¨ CRITICAL: Loot table book has dangerous clickEvent"
        echo "        Command: $cmd"
        sec_warnings=$((sec_warnings + 1))
        SECURITY_ISSUES=$((SECURITY_ISSUES + 1))
      fi
    fi
  fi
done < <(find new_versions -path "*/datapack/data/*/loot_table/*.json" -o -path "*/datapack/data/*/loot_tables/*.json" -type f -print0 2>/dev/null || true)

echo "  ðŸ“Š Found $loot_book_count loot table(s) with books"
